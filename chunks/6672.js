(self.webpackChunkgeog863_final=self.webpackChunkgeog863_final||[]).push([[6672],{16635:(e,t,s)=>{"use strict";s.d(t,{vX:()=>c,s5:()=>o,k3:()=>l,Or:()=>n}),Number.POSITIVE_INFINITY;const i=128/Math.PI,r=1/Math.LN2;function a(e,t){return(e%=t)>=0?e:e+t}function n(e){return a(e*i,256)}function o(e){return a(.7111111111111111*e,256)}function l(e){return Math.log(e)*r}function c(e,t,s){return e>=t&&e<=s||e>=s&&e<=t}},29256:(e,t,s)=>{"use strict";s.d(t,{Ki:()=>c,Ao:()=>h,yB:()=>l,Hn:()=>n,GF:()=>o});var i=s(18193),r=s(17821),a=s(33142);const n=0,o=1,l=2;class c{constructor(e,t){this.width=e,this.height=t;const s=Math.ceil(e/1),i=Math.ceil(t/1);this._cols=s,this._rows=i,this._cells=r.p.create(s*i)}insertMetrics(e){const t=this._hasCollision(e);return t===n&&this._markMetrics(e),t}getCellId(e,t){return e+t*this._cols}has(e){return this._cells.has(e)}hasRange(e,t){return this._cells.hasRange(e,t)}set(e){this._cells.set(e)}setRange(e,t){this._cells.setRange(e,t)}_hasCollision(e){const t=e.id;let s=0,i=0;e.save();do{const t=e.boundsCount;s+=t;for(let s=0;s<t;s++){const t=e.boundsComputedAnchorX(s),r=e.boundsComputedAnchorY(s),a=e.boundsWidth(s)+2,n=e.boundsHeight(s)+2;switch(this._collide(t,r,a,n)){case l:return l;case o:i++}}}while(e.peekId()===t&&e.next());return e.restore(),s===i?o:n}_collide(e,t,s,r){const a=e-s/2,c=e+s/2,h=t-r/2,d=t+r/2;if(c<0||d<0||a>this.width||h>this.height)return o;const u=(0,i.uZ)(Math.floor(a/1),0,this._cols),v=(0,i.uZ)(Math.floor(h/1),0,this._rows),p=(0,i.uZ)(Math.ceil(c/1),0,this._cols),g=(0,i.uZ)(Math.ceil(d/1),0,this._rows);for(let e=v;e<=g;e++)for(let t=u;t<=p;t++){const s=this.getCellId(t,e);if(this.has(s))return l}return n}_mark(e,t,s,r){const a=e-s/2,n=e+s/2,o=t-r/2,l=t+r/2,c=(0,i.uZ)(Math.floor(a/1),0,this._cols),h=(0,i.uZ)(Math.floor(o/1),0,this._rows),d=(0,i.uZ)(Math.ceil(n/1),0,this._cols),u=(0,i.uZ)(Math.ceil(l/1),0,this._rows);for(let e=h;e<=u;e++)for(let t=c;t<=d;t++){const s=this.getCellId(t,e);this.set(s)}return!1}_markMetrics(e){const t=e.id;do{const t=e.boundsCount;for(let s=0;s<t;s++){const t=e.boundsComputedAnchorX(s),i=e.boundsComputedAnchorY(s),r=e.boundsWidth(s)+2,a=e.boundsHeight(s)+2;this._mark(t,i,r,a)}}while(e.peekId()===t&&e.next())}}class h{constructor(e,t=2){this._bucketSize=e,this._rowsLength=a.I_/e,this._colsLength=a.I_/e,this._elementsPerBucket=t,this._grid=this._initGrid()}checkOverlap(e,t){const s=Math.floor(e/this._bucketSize),i=Math.floor(t/this._bucketSize);return s<0||s>=this._rowsLength||i<0||i>=this._colsLength||this._grid[i*this._colsLength+s]>=this._elementsPerBucket}markUsed(e,t){const s=Math.floor(e/this._bucketSize),i=Math.floor(t/this._bucketSize);this._grid[i*this._colsLength+s]+=1}reset(){this._grid=this._initGrid()}_initGrid(){return new Uint8Array(this._rowsLength*this._colsLength)}}},26986:(e,t,s)=>{"use strict";s.d(t,{dk:()=>v,Gq:()=>y,a:()=>g,mE:()=>p,m2:()=>l,qr:()=>f,jj:()=>n,hF:()=>o});var i=s(29107),r=s(9963),a=s(18562);function n(e,t,s,i,a){switch(e){case r.LW.FILL:return v.from(t,i);case r.LW.LINE:return g.from(t,s);case r.LW.MARKER:return p.from(t);case r.LW.TEXT:return f.from(t);case r.LW.LABEL:return y.from(t,a);default:throw new Error(`Unable to createMaterialKey for unknown geometryType ${e}`)}}function o(e){switch(l.load(e).geometryType){case r.LW.MARKER:return new p(e);case r.LW.FILL:return new v(e);case r.LW.LINE:return new g(e);case r.LW.TEXT:return new f(e);case r.LW.LABEL:return new y(e)}}class l{constructor(e){this._data=0,this._data=e}static load(e){const t=this.shared;return t.data=e,t}set data(e){this._data=e}get data(){return this._data}get geometryType(){return this.bits(8,11)}set geometryType(e){this.setBits(e,8,11)}get mapAligned(){return!!this.bit(20)}set mapAligned(e){this.setBit(20,e)}get sdf(){return!!this.bit(11)}set sdf(e){this.setBit(11,e)}get pattern(){return!!this.bit(12)}set pattern(e){this.setBit(12,e)}get textureBinding(){return this.bits(0,8)}set textureBinding(e){this.setBits(e,0,8)}get geometryTypeString(){switch(this.geometryType){case r.LW.FILL:return"fill";case r.LW.MARKER:return"marker";case r.LW.LINE:return"line";case r.LW.TEXT:return"text";case r.LW.LABEL:return"label";default:throw new i.Z(`Unable to handle unknown geometryType: ${this.geometryType}`)}}setBit(e,t){const s=1<<e;t?this._data|=s:this._data&=~s}bit(e){return(this._data&1<<e)>>e}setBits(e,t,s){for(let i=t,r=0;i<s;i++,r++)this.setBit(i,0!=(e&1<<r))}bits(e,t){let s=0;for(let i=e,r=0;i<t;i++,r++)s|=this.bit(i)<<r;return s}hasVV(){return!1}setVV(e,t){}getVariation(){return{mapAligned:this.mapAligned,pattern:this.pattern,sdf:this.sdf}}getVariationHash(){return this._data&~(7&this.textureBinding)}}l.shared=new l(0);const c=e=>class extends e{get vvSizeMinMaxValue(){return 0!==this.bit(16)}set vvSizeMinMaxValue(e){this.setBit(16,e)}get vvSizeScaleStops(){return 0!==this.bit(17)}set vvSizeScaleStops(e){this.setBit(17,e)}get vvSizeFieldStops(){return 0!==this.bit(18)}set vvSizeFieldStops(e){this.setBit(18,e)}get vvSizeUnitValue(){return 0!==this.bit(19)}set vvSizeUnitValue(e){this.setBit(19,e)}hasVV(){return super.hasVV()||this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue}setVV(e,t){super.setVV(e,t);const s=function(e,t=!1){const s=r.X.SIZE_FIELD_STOPS|r.X.SIZE_MINMAX_VALUE|r.X.SIZE_SCALE_STOPS|r.X.SIZE_UNIT_VALUE,i=(e&(r.mf.FIELD_TARGETS_OUTLINE|r.mf.MINMAX_TARGETS_OUTLINE|r.mf.SCALE_TARGETS_OUTLINE|r.mf.UNIT_TARGETS_OUTLINE))>>>4;return t?s&i:s&~i}(e,t)&e;this.vvSizeMinMaxValue=!!(s&r.X.SIZE_MINMAX_VALUE),this.vvSizeFieldStops=!!(s&r.X.SIZE_FIELD_STOPS),this.vvSizeUnitValue=!!(s&r.X.SIZE_UNIT_VALUE),this.vvSizeScaleStops=!!(s&r.X.SIZE_SCALE_STOPS)}},h=e=>class extends e{get vvRotation(){return 0!==this.bit(15)}set vvRotation(e){this.setBit(15,e)}hasVV(){return super.hasVV()||this.vvRotation}setVV(e,t){super.setVV(e,t),this.vvRotation=!t&&!!(e&r.X.ROTATION)}},d=e=>class extends e{get vvColor(){return 0!==this.bit(13)}set vvColor(e){this.setBit(13,e)}hasVV(){return super.hasVV()||this.vvColor}setVV(e,t){super.setVV(e,t),this.vvColor=!t&&!!(e&r.X.COLOR)}},u=e=>class extends e{get vvOpacity(){return 0!==this.bit(14)}set vvOpacity(e){this.setBit(14,e)}hasVV(){return super.hasVV()||this.vvOpacity}setVV(e,t){super.setVV(e,t),this.vvOpacity=!t&&!!(e&r.X.OPACITY)}};class v extends(d(u(l))){static load(e){const t=this.shared;return t.data=e,t}static from(e,t){const s=this.load(0);return s.geometryType=r.LW.FILL,t?s.dotDensity=!0:s.setVV(e,!1),s.data}getVariation(){return{...super.getVariation(),dotDensity:this.dotDensity,vvColor:this.vvColor,vvOpacity:this.vvOpacity}}get dotDensity(){return!!this.bit(15)}set dotDensity(e){this.setBit(15,e)}}v.shared=new v(0);class p extends(d(u(h(c(l))))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=r.LW.MARKER,t.setVV(e,!1),t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvRotation:this.vvRotation,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}p.shared=new p(0);class g extends(d(u(c(l)))){static load(e){const t=this.shared;return t.data=e,t}static from(e,t){const s=this.load(0);return s.geometryType=r.LW.LINE,s.setVV(e,t),s.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}g.shared=new g(0);class f extends(d(u(h(c(l))))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(e);return t.geometryType=r.LW.TEXT,t.setVV(e,!1),t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvRotation:this.vvRotation,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}f.shared=new f(0);class y extends(c(l)){static load(e){const t=this.shared;return t.data=e,t}static from(e,t){const s=this.load(0);return s.geometryType=r.LW.LABEL,s.setVV(e,!1),s.mapAligned=!!(0,a.N)(t),s.data}getVariation(){return{...super.getVariation(),vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}y.shared=new y(0)},18562:(e,t,s)=>{"use strict";function i(e){switch(e){case"above-along":case"below-along":case"center-along":return 1;default:return 0}}s.d(t,{N:()=>i})},19621:(e,t,s)=>{"use strict";s.d(t,{Z:()=>l});var i=s(87397),r=(s(1867),s(9783),s(9385),s(82203)),a=s(65482),n=(s(17593),s(15392),s(11786),s(74893));let o=class extends n.r{initialize(){}destroy(){}get supportsTileUpdates(){return!1}get spatialReference(){const e=this.get("tileStore.tileScheme.spatialReference");return e&&e.toJSON()||null}};(0,i._)([(0,r.Cb)({readOnly:!0})],o.prototype,"supportsTileUpdates",null),(0,i._)([(0,r.Cb)({constructOnly:!0})],o.prototype,"remoteClient",void 0),(0,i._)([(0,r.Cb)({constructOnly:!0})],o.prototype,"service",void 0),(0,i._)([(0,r.Cb)()],o.prototype,"spatialReference",null),(0,i._)([(0,r.Cb)({constructOnly:!0})],o.prototype,"tileInfo",void 0),(0,i._)([(0,r.Cb)({constructOnly:!0})],o.prototype,"tileStore",void 0),o=(0,i._)([(0,a.j)("esri.views.2d.layers.features.processors.BaseProcessor")],o);const l=o},96433:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>M});var i=s(87397),r=s(1867),a=s(18029),n=s(9783),o=(s(9385),s(82203),s(65482)),l=(s(29107),s(17593),s(15392),s(11786),s(14790)),c=s(12031),h=s(9372),d=s(33142),u=s(53372),v=s(29256),p=s(77246),g=s(65534),f=s(74200),y=s(98103),_=s(40966),S=s(87188),m=s(96642),V=s(97486),L=s(19621);function b(e){const t=e.message,s={message:{data:{},tileKey:t.tileKey},transferList:new Array};for(const e in t.data){const i=t.data[e];if(s.message.data[e]=null,(0,a.pC)(i)){const t=i.stride,r=i.indices.slice(0),n=i.vertices.slice(0),o=i.records.slice(0),l={stride:t,indices:r,vertices:n,records:o,metrics:(0,a.Po)(i.metrics,(e=>e.slice(0)))};s.transferList.push(r,n,o),s.message.data[e]=l}}return s}n.Z.getLogger("esri.views.2d.layers.features.processors.SymbolProcessor");let T=class extends L.Z{constructor(){super(...arguments),this.type="symbol",this._matchers={feature:null,aggregate:null},this._bufferData=new Map}initialize(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))])}destroy(){}get supportsTileUpdates(){return!0}async update(e,t){const s=t.schema.processors[0];if("symbol"!==s.type)return;const i=(0,h.Hg)(this._schema,s);(0,h.uD)(i,"mesh")&&((0,r.Z)("esri-2d-update-debug")&&console.debug("Applying Update - Processor:",i),e.mesh=!0,e.why.mesh.push("Symbology changed"),this._schema=s,this._factory=this._createFactory(s),this._factory.update(s,this.tileStore.tileScheme.tileInfo))}onTileMessage(e,t,s,i){return(0,l.k_)(i),this._onTileData(e,t,s,i)}onTileClear(e){return this._bufferData.delete(e.key.id),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:{clear:!0}})}onTileError(e,t,s){const i=s.signal,r={tileKey:e.id,error:t};return this.remoteClient.invoke("tileRenderer.onTileError",r,{signal:i})}onTileUpdate(e){for(const t of e.removed)this._bufferData.has(t.key.id)&&(this._bufferData.get(t.key.id).forEach((e=>{const t=new Set;(0,p.Z_)((s=>{const i=e.message.data[s];if((0,a.pC)(i)){const e=g.$.from(i.records).getCursor();for(;e.next();)t.add(e.id)}}));const s=e.message.tileKey;return this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:s,data:{type:"update",addOrUpdate:null}})})),this._bufferData.delete(t.key.id));for(const t of e.added)this._bufferData.forEach((e=>{for(const s of e)s.message.tileKey===t.id&&this._updateTileMesh("append",t,b(s),[],!1,!1,null)}))}_addBufferData(e,t){this._bufferData.has(e)||this._bufferData.set(e,[]),this._bufferData.get(e).push(b(t))}_createFactory(e){const{geometryType:t,objectIdField:s,fields:i}=this.service,r={geometryType:t,fields:i,spatialReference:c.Z.fromJSON(this.spatialReference)},n=new m.W(((e,t)=>this.remoteClient.invoke("tileRenderer.getMaterialItems",e,t)),!1),{matcher:o,aggregateMatcher:l}=e.mesh;return this._store=n,this._matchers.feature=(0,_.f)(o,n,r),this._matchers.aggregate=(0,a.Po)(l,(e=>(0,_.f)(e,n,r))),new V.j(t,s,n)}async _onTileData(e,t,s,i){const{type:r,addOrUpdate:n,remove:o}=t,c=t.end;if(!n){const t={type:r,addOrUpdate:null,remove:o,clear:!1,end:c};return this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:t},i)}const h=this._processFeatures(e,n,s,i);try{const s=await h;if((0,a.Wi)(s)){const t={type:r,addOrUpdate:null,remove:o,clear:!1,end:c};return this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:t},i)}for(const t of s)e.key.id!==t.message.tileKey&&this._addBufferData(e.key.id,t);await(0,l.$6)(s.map((s=>{const a=e.key.id===s.message.tileKey,n=a?t.remove:[],o=a&&t.end;return this._updateTileMesh(r,e,s,n,o,t.clear,i.signal)})))}catch(t){this._handleError(e,t,i)}}async _updateTileMesh(e,t,s,i,r,n,o){const c=e,h=s.message.tileKey;h!==t.key.id&&(r=!1);const d=(0,a.Po)(s,(e=>e.message)),u=(0,a.Po)(s,(e=>e.transferList))||[],v={type:c,addOrUpdate:d,remove:i,clear:!1,end:r},p={transferList:(0,a.Wg)(u)||[],signal:o};return(0,l.k_)(p),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:h,data:v},p)}async _processFeatures(e,t,s,i){if((0,a.Wi)(t)||!t.hasFeatures)return null;const r={transform:e.transform,hasZ:!1,hasM:!1},n=this._factory,o={viewingMode:"",scale:e.scale},c=await this._matchers.feature,h=await this._matchers.aggregate;(0,l.k_)(i);const d=this._getLabelInfos(e,t);return await n.analyze(t.getCursor(),c,h,r,o),(0,l.k_)(i),this._writeFeatureSet(e,t,r,d,n,s)}_writeFeatureSet(e,t,s,i,r,n){const o=t.getApproximateSize(),l="simple"===this._schema.mesh.matcher.type&&this._schema.mesh.matcher.isDotDensity,c=new y._(e.key.id,{features:o,records:o,metrics:0},l,n,!0),h={viewingMode:"",scale:e.scale},d=t.getCursor();for(;d.next();)try{const t=d.getDisplayId(),n=(0,a.pC)(i)?i.get(t):null;r.writeCursor(c,d,s,h,e.level,n)}catch(e){}const u=e.tileInfoView.tileInfo.isWrappable;return c.serialize(u)}_handleError(e,t,s){if(!(0,l.D_)(t)){const i={tileKey:e.id,error:t.message};return this.remoteClient.invoke("tileRenderer.onTileError",i,{signal:s.signal})}}_getLabelInfos(e,t){const s=this._schema.mesh.labels,i=(0,a.Po)(s,(t=>t.filter((t=>function(e,t){return(!e.minScale||e.minScale>=t)&&(!e.maxScale||e.maxScale<=t)}(t,e.scale)))));if((0,a.Wi)(i)||0===i.length)return null;const r=new Map,n=(new v.Ao(d.wz),t.getCursor());for(;n.next();){const e=n.getDisplayId(),t=[],s=(0,f.nE)(e),a=s&&1!==n.readAttribute("cluster_count")?"aggregate":"feature";for(const r of i){if(r.target!==a)continue;const i=n.getStorage(),o=s&&"feature"===a?i.getComputedStringAtIndex(n.readAttribute("referenceId"),r.fieldIndex):i.getComputedStringAtIndex(e,r.fieldIndex);if(!o)continue;const l=(0,u.E)(o.toString()),c=l[0],h=l[1];this._store.getMosaicItem(r.symbol,(0,S._)(c)).then((e=>{t[r.index]={glyphs:e.glyphMosaicItems,rtl:h,index:r.index}}))}r.set(e,t)}return r}_shouldDiscard(e,t){switch(this.service.geometryType){case"esriGeometryPoint":{const s=t.readLegacyPointGeometry();return!s||e.checkOverlap(s.x,s.y)}case"esriGeometryPolygon":{const s=t.readLegacyCentroid();return!s||e.checkOverlap(s.x,s.y)}default:return!1}}_markUsed(e,t){switch(this.service.geometryType){case"esriGeometryPoint":{const{x:s,y:i}=t.readLegacyPointGeometry();return e.markUsed(s,i)}case"esriGeometryPolygon":{const{x:s,y:i}=t.readLegacyCentroid();return e.markUsed(s,i)}}}};T=(0,i._)([(0,o.j)("esri.views.2d.layers.features.processors.SymbolProcessor")],T);const M=T}}]);