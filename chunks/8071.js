(self.webpackChunkgeog863_final=self.webpackChunkgeog863_final||[]).push([[8071,1598],{51598:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>C});var s=i(87397),r=(i(1867),i(31641)),a=i(18029),h=(i(9783),i(9385),i(82203)),o=i(65482),n=(i(17593),i(15392),i(11786),i(78513)),c=i(70314),l=i(66119),p=i(25362),d=i(89214),v=i(93831),_=i(58115);class g{constructor(t,e,i,s,r){this.graphic=t,this.index=e,this.x=i,this.y=s,this.viewEvent=r,this.type="graphic-click"}}class y{constructor(t,e,i,s,r){this.graphic=t,this.index=e,this.x=i,this.y=s,this.viewEvent=r,this.type="graphic-double-click"}}class u{constructor(t,e,i,s,r,a,h,o,n,c){this.graphic=t,this.allGraphics=e,this.index=i,this.x=s,this.y=r,this.dx=a,this.dy=h,this.totalDx=o,this.totalDy=n,this.viewEvent=c,this.defaultPrevented=!1,this.type="graphic-move-start"}preventDefault(){this.defaultPrevented=!0}}class m{constructor(t,e,i,s,r,a,h,o,n,c){this.graphic=t,this.allGraphics=e,this.index=i,this.x=s,this.y=r,this.dx=a,this.dy=h,this.totalDx=o,this.totalDy=n,this.viewEvent=c,this.defaultPrevented=!1,this.type="graphic-move"}preventDefault(){this.defaultPrevented=!0}}class b{constructor(t,e,i,s,r,a,h,o,n,c){this.graphic=t,this.allGraphics=e,this.index=i,this.x=s,this.y=r,this.dx=a,this.dy=h,this.totalDx=o,this.totalDy=n,this.viewEvent=c,this.defaultPrevented=!1,this.type="graphic-move-stop"}preventDefault(){this.defaultPrevented=!0}}class f{constructor(t,e,i,s,r){this.graphic=t,this.index=e,this.x=i,this.y=s,this.viewEvent=r,this.type="graphic-pointer-over"}}class G{constructor(t,e,i,s,r){this.graphic=t,this.index=e,this.x=i,this.y=s,this.viewEvent=r,this.type="graphic-pointer-out"}}class x{constructor(t,e,i,s,r){this.graphic=t,this.index=e,this.x=i,this.y=s,this.viewEvent=r,this.type="graphic-pointer-down"}}class w{constructor(t,e,i,s,r){this.graphic=t,this.index=e,this.x=i,this.y=s,this.viewEvent=r,this.type="graphic-pointer-up"}}let S=class extends n.Z.EventedAccessor{constructor(t){super(t),this._activeGraphic=null,this._dragEvent=null,this._handles=new c.Z,this._hoverGraphic=null,this._initialDragGeometry=null,this._viewHandles=new c.Z,this._manipulators=[],this.type="graphic-mover",this.callbacks={onGraphicClick(){},onGraphicDoubleClick(){},onGraphicMoveStart(){},onGraphicMove(){},onGraphicMoveStop(){},onGraphicPointerOver(){},onGraphicPointerOut(){},onGraphicPointerDown(){},onGraphicPointerUp(){}},this.enableMoveAllGraphics=!1,this.graphics=[],this.view=null}initialize(){this._setUpManipulators(),this._handles.add([(0,l.YP)(this,["graphics","graphics.length"],(()=>{this._setUpManipulators()})),(0,l.N1)(this,"view.ready",(()=>{this._viewHandles.add([this.view.on("immediate-click",(t=>this._clickHandler(t)),p.f.TOOL),this.view.on("double-click",(t=>this._doubleClickHandler(t)),p.f.TOOL),this.view.on("pointer-down",(t=>this._pointerDownHandler(t)),p.f.TOOL),this.view.on("pointer-move",(t=>this._pointerMoveHandler(t)),p.f.TOOL),this.view.on("pointer-up",(t=>this._pointerUpHandler(t)),p.f.TOOL),this.view.on("drag",(t=>this._dragHandler(t)),p.f.TOOL),this.view.on("key-down",(t=>this._keyDownHandler(t)),p.f.TOOL)])}))])}destroy(){this.reset(),this._manipulators.forEach((t=>t.destroy())),this._manipulators=null,this._viewHandles.removeAll(),this._handles.removeAll()}get state(){const t=!!this.get("view.ready"),e=!!this.get("graphics.length"),i=this._activeGraphic;return t&&e?i?"moving":"active":t?"ready":"disabled"}reset(){this._activeGraphic=null,this._hoverGraphic=null,this._dragEvent=null}updateGeometry(t,e){const i=this.graphics[t];i&&i.set("geometry",e)}_clickHandler(t){const e=this._findTargetGraphic((0,d.vT)(t));if(e){const i=new g(e,this.graphics.indexOf(e),t.x,t.y,t);this.emit("graphic-click",i),this.callbacks.onGraphicClick&&this.callbacks.onGraphicClick(i)}}_doubleClickHandler(t){const e=this._findTargetGraphic((0,d.vT)(t));if(e){const i=new y(e,this.graphics.indexOf(e),t.x,t.y,t);this.emit("graphic-double-click",i),this.callbacks.onGraphicDoubleClick&&this.callbacks.onGraphicDoubleClick(i)}}_pointerDownHandler(t){const e=this._findTargetGraphic((0,d.vT)(t));if(e){this._activeGraphic=e;const{x:i,y:s}=t,r=new x(e,this.graphics.indexOf(e),i,s,t);this.emit("graphic-pointer-down",r),this.callbacks.onGraphicPointerDown&&this.callbacks.onGraphicPointerDown(r)}else this._activeGraphic=null}_pointerUpHandler(t){if(this._activeGraphic){const{x:e,y:i}=t,s=this.graphics.indexOf(this._activeGraphic),r=new w(this._activeGraphic,s,e,i,t);this.emit("graphic-pointer-up",r),this.callbacks.onGraphicPointerUp&&this.callbacks.onGraphicPointerUp(r)}}_pointerMoveHandler(t){if(this._dragEvent)return;const e=this._findTargetGraphic((0,d.vT)(t));if(e){const{x:i,y:s}=t;if(this._hoverGraphic){if(this._hoverGraphic===e)return;const r=this.graphics.indexOf(this._hoverGraphic),a=new G(this.graphics[r],r,i,s,t);this._hoverGraphic=null,this.emit("graphic-pointer-out",a),this.callbacks.onGraphicPointerOut&&this.callbacks.onGraphicPointerOut(a)}const r=this.graphics.indexOf(e),a=new f(e,r,i,s,t);return this._hoverGraphic=e,this.emit("graphic-pointer-over",a),void(this.callbacks.onGraphicPointerOver&&this.callbacks.onGraphicPointerOver(a))}if(this._hoverGraphic){const{x:e,y:i}=t,s=this.graphics.indexOf(this._hoverGraphic),r=new G(this.graphics[s],s,e,i,t);this._hoverGraphic=null,this.emit("graphic-pointer-out",r),this.callbacks.onGraphicPointerOut&&this.callbacks.onGraphicPointerOut(r)}}_dragHandler(t){if("start"!==t.action&&!this._dragEvent||!this._activeGraphic||!this._activeGraphic.geometry)return;t.stopPropagation();const{action:e,x:i,y:s}=t,a=this.graphics.indexOf(this._activeGraphic),h=this._activeGraphic.geometry,o=this._dragEvent?i-this._dragEvent.x:0,n=this._dragEvent?s-this._dragEvent.y:0,c=i-t.origin.x,l=s-t.origin.y;if(this._activeGraphic.geometry=(0,v.e7)(h,o,n,this.view),this.enableMoveAllGraphics&&this.graphics.forEach((t=>{t!==this._activeGraphic&&(t.geometry=(0,v.e7)(t.geometry,o,n,this.view))})),this._dragEvent=t,"start"===e){this._initialDragGeometry=(0,r.d9)(h);const e=new u(this._activeGraphic,this.graphics,a,i,s,o,n,c,l,t);this.emit("graphic-move-start",e),this.callbacks.onGraphicMoveStart&&this.callbacks.onGraphicMoveStart(e),e.defaultPrevented&&this._activeGraphic.set("geometry",h)}else if("update"===e){const e=new m(this._activeGraphic,this.graphics,a,i,s,o,n,c,l,t);this.emit("graphic-move",e),this.callbacks.onGraphicMove&&this.callbacks.onGraphicMove(e),e.defaultPrevented&&this._activeGraphic.set("geometry",h)}else{const e=new b(this._activeGraphic,this.graphics,a,i,s,o,n,c,l,t);this._dragEvent=null,this._activeGraphic=null,this.emit("graphic-move-stop",e),this.callbacks.onGraphicMoveStop&&this.callbacks.onGraphicMoveStop(e),e.defaultPrevented&&this.graphics[a].set("geometry",this._initialDragGeometry),this._initialDragGeometry=null}}_keyDownHandler(t){"a"!==t.key&&"d"!==t.key&&"n"!==t.key||"moving"!==this.state||t.stopPropagation()}_findTargetGraphic(t){let e=null,i=Number.MAX_VALUE;return this._manipulators.forEach((s=>{const r=s.intersectionDistance(t);(0,a.pC)(r)&&r<i&&(i=r,e=s.graphic)})),e}_setUpManipulators(){const{graphics:t,view:e}=this;this._manipulators.forEach((t=>t.destroy())),this._manipulators=null!=t&&t.length?t.map((t=>new _.L({graphic:t,view:e}))):[]}};(0,s._)([(0,h.Cb)()],S.prototype,"_activeGraphic",void 0),(0,s._)([(0,h.Cb)({readOnly:!0})],S.prototype,"type",void 0),(0,s._)([(0,h.Cb)()],S.prototype,"callbacks",void 0),(0,s._)([(0,h.Cb)()],S.prototype,"enableMoveAllGraphics",void 0),(0,s._)([(0,h.Cb)()],S.prototype,"graphics",void 0),(0,s._)([(0,h.Cb)({readOnly:!0})],S.prototype,"state",null),(0,s._)([(0,h.Cb)()],S.prototype,"view",void 0),S=(0,s._)([(0,o.j)("esri.views.draw.support.GraphicMover")],S);const C=S},88071:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>Z});var s=i(87397),r=(i(1867),i(18029)),a=(i(9783),i(9385),i(82203)),h=i(65482),o=(i(17593),i(15392),i(11786),i(14790)),n=i(49749),c=i(38283),l=(i(36458),i(78513)),p=i(72593),d=i(67794),v=i(70314),_=i(66119),g=i(25362),y=i(22980),u=i(51545),m=i(6541),b=i(30154),f=i(5156),G=i(93831),x=i(15355),w=i(51598);class S{constructor(t,e,i){this.graphic=t,this.mover=e,this.selected=i,this.type="reshape-start"}}class C{constructor(t,e,i){this.graphic=t,this.mover=e,this.selected=i,this.type="reshape"}}class k{constructor(t,e,i){this.graphic=t,this.mover=e,this.selected=i,this.type="reshape-stop"}}class H{constructor(t,e,i){this.mover=t,this.dx=e,this.dy=i,this.type="move-start"}}class M{constructor(t,e,i){this.mover=t,this.dx=e,this.dy=i,this.type="move"}}class E{constructor(t,e,i){this.mover=t,this.dx=e,this.dy=i,this.type="move-stop"}}class O{constructor(t){this.added=t,this.type="vertex-select"}}class D{constructor(t){this.removed=t,this.type="vertex-deselect"}}class I{constructor(t,e,i,s){this.added=t,this.graphic=e,this.oldGraphic=i,this.vertices=s,this.type="vertex-add"}}class V{constructor(t,e,i,s){this.removed=t,this.graphic=e,this.oldGraphic=i,this.vertices=s,this.type="vertex-remove"}}const P={removeVertex:["Backspace","Delete"]},R=y.X.reshapeGraphics,A={vertices:{default:new p.default({style:"circle",size:R.vertex.size,color:R.vertex.color,outline:{color:R.vertex.outlineColor,width:1}}),hover:new p.default({style:"circle",size:R.vertex.hoverSize,color:R.vertex.hoverColor,outline:{color:R.vertex.hoverOutlineColor,width:1}}),selected:new p.default({style:"circle",size:R.selected.size,color:R.selected.color,outline:{color:R.selected.outlineColor,width:1}})},midpoints:{default:new p.default({style:"circle",size:R.midpoint.size,color:R.midpoint.color,outline:{color:R.midpoint.outlineColor,width:1}}),hover:new p.default({style:"circle",size:R.midpoint.size,color:R.midpoint.color,outline:{color:R.midpoint.outlineColor,width:1}})}};let T=class extends l.Z.EventedAccessor{constructor(t){super(t),this._handles=new v.Z,this._graphicAttributes={esriSketchTool:"box"},this._mover=null,this._snappingTask=null,this._stagedVertex=null,this._totalDx=0,this._totalDy=0,this._viewHandles=new v.Z,this.callbacks={onReshapeStart(){},onReshape(){},onReshapeStop(){},onMoveStart(){},onMove(){},onMoveStop(){},onGraphicClick(){}},this.enableMidpoints=!0,this.graphic=null,this.handleGraphics=[],this.layer=null,this.midpointGraphics=[],this.midpointSymbol=new p.default({style:"circle",size:6,color:[200,200,200],outline:{color:[100,100,100],width:1}}),this.selectedHandles=[],this.snappingManager=null,this.type="reshape",this.view=null}initialize(){this._setup(),this._handles.add([(0,_.N1)(this,"view.ready",(()=>{const{layer:t,view:e}=this;(0,x.p)(e,t),this._viewHandles.add([e.on("key-down",(t=>this._keyDownHandler(t)),g.f.TOOL)])})),(0,_.Wy)(this,"graphic",(()=>this.refresh())),(0,_.Wy)(this,"layer",((t,e)=>{e&&(this._clearSelection(),this._resetGraphics(e)),this.refresh()})),(0,_.Wy)(this,"enableMidpoints",(()=>{this.refresh()}))])}destroy(){this._reset(),this._mover&&this._mover.destroy(),this._mover=null,this._handles.removeAll(),this._handles=null,this._viewHandles.removeAll(),this._viewHandles=null}get state(){const t=!!this.get("view.ready"),e=!(!this.get("graphic")||!this.get("layer"));return t&&e?"active":t?"ready":"disabled"}set symbols(t){const{midpoints:e=A.midpoints,vertices:i=A.vertices}=t||{};this._set("symbols",{midpoints:e,vertices:i})}isUIGraphic(t){const e=[];return this.graphic&&e.push(this.graphic),e.concat(this.handleGraphics,this.midpointGraphics),e.length&&e.includes(t)}refresh(){this._reset(),this._setup()}reset(){this.graphic=null}clearSelection(){this._clearSelection()}removeSelectedHandles(){this.selectedHandles.length&&this._removeVertex(this.selectedHandles)}_setup(){this.graphic&&this.layer&&(this._setupGraphics(),this._setupMover())}_setUpGeometryHelper(){const t=this.graphic.geometry;(0,r.Wi)(t)||"polygon"!==t.type&&"polyline"!==t.type||(this._geometryHelper=new b.hE(m.XE.fromGeometry(t,"local"),t.type))}_saveSnappingContextForHandle(t,e){var i;this._snappingContext=new f.N({geometry:this._geometryHelper,elevationInfo:{mode:"on-the-ground",offset:0},pointer:(null==(i=e.viewEvent)?void 0:i.pointerType)||"mouse",excludeFeature:this.graphic,visualizer:new u.r,vertexHandle:this._getVertexFromEditGeometry(t)})}_reset(){this._clearSelection(),this._resetGraphicStateVars(),this._resetGraphics(),this._resetSnappingStateVars(),this._mover&&this._mover.destroy(),this._mover=null,this.view.cursor="default"}_resetSnappingStateVars(){var t;(0,r.pC)(this.snappingManager)&&this.snappingManager.doneSnapping(),null==(t=this._geometryHelper)||t.destroy(),this._geometryHelper=null,this._snappingTask=(0,r.IM)(this._snappingTask),this._snappingTask=null,this._snappingContext=null,this._stagedVertex=null}_resetGraphicStateVars(){this._totalDx=0,this._totalDy=0}_resetGraphics(t){const e=t||this.layer;e&&(e.removeMany(this.handleGraphics),e.removeMany(this.midpointGraphics)),this.handleGraphics.forEach((t=>t.destroy())),this.midpointGraphics.forEach((t=>t.destroy())),this._set("handleGraphics",[]),this._set("midpointGraphics",[]),this._set("selectedHandles",[])}_setupGraphics(){const t=(0,r.Wg)(this.graphic.geometry),e=(0,c.nA)(t.clone());if("polygon"===t.type)for(const t of e){const e=t[t.length-1];t[0][0]===e[0]&&t[0][1]===e[1]&&t.length>2&&t.pop()}this._set("handleGraphics",this._createHandleGraphics(e)),this.enableMidpoints&&this._set("midpointGraphics",this._createMidpointGraphics(e)),this._saveRelatedIndices(this.handleGraphics),this.layer.addMany(this.midpointGraphics),this.layer.addMany(this.handleGraphics)}_createHandleGraphics(t){const{_graphicAttributes:e,symbols:i,view:{spatialReference:s}}=this,r=[];return null==t||t.forEach(((t,a)=>{t.forEach(((t,h)=>{var o;const[c,l]=t;r.push(new d.Z({geometry:new n.Z({x:c,y:l,spatialReference:s}),symbol:null==i||null==(o=i.vertices)?void 0:o.default,attributes:{...e,pathIndex:a,pointIndex:h}}))}))})),r}_createMidpointGraphics(t){const{_graphicAttributes:e,symbols:i,view:{spatialReference:s}}=this,a=[];return null==t||t.forEach(((t,h)=>{t.forEach(((o,l)=>{const[p,v]=o,_=t[l+1]?l+1:0;if("polygon"===(0,r.U2)(this.graphic.geometry,"type")||0!==_){const[r,o]=t[_],[g,y]=(0,c.Gi)([p,v],[r,o]);a.push(new d.Z({geometry:new n.Z({x:g,y,spatialReference:s}),symbol:i.midpoints.default,attributes:{...e,pathIndex:h,pointIndexStart:l,pointIndexEnd:_}}))}}))})),a}_saveRelatedIndices(t){if(!t)return;const e=t.map((({geometry:t})=>({x:t.x,y:t.y})));for(let i=0;i<e.length;i++){const s=[];for(let t=0;t<e.length;t++){if(i===t)continue;const r=e[i],a=e[t];r.x===a.x&&r.y===a.y&&s.push(t)}t[i].attributes.relatedGraphicIndices=s}}_setupMover(){this._mover=new w.default({enableMoveAllGraphics:!1,graphics:[].concat(this.handleGraphics,this.midpointGraphics,this.graphic),view:this.view,callbacks:{onGraphicClick:t=>this._onGraphicClickCallback(t),onGraphicMoveStart:t=>this._onGraphicMoveStartCallback(t),onGraphicMove:t=>this._onGraphicMoveCallback(t),onGraphicMoveStop:t=>this._onGraphicMoveStopCallback(t),onGraphicPointerOver:t=>this._onGraphicPointerOverCallback(t),onGraphicPointerOut:t=>this._onGraphicPointerOutCallback(t)}})}_onGraphicClickCallback(t){t.viewEvent.stopPropagation();const e=t.graphic;if(e===this.graphic)this.clearSelection(),this.emit("graphic-click",t),this.callbacks.onGraphicClick&&this.callbacks.onGraphicClick(t);else if(this._isMidpoint(e)){if(2===t.viewEvent.button)return;const i=this.graphic.clone(),s=this._createHandleFromMidpoint(e);this.refresh(),this._emitVertexAddEvent([e],i,s)}else this._isHandle(e)&&(t.viewEvent.stopPropagation(),2===t.viewEvent.button?this._removeVertex(e):(t.viewEvent.native.shiftKey||this._clearSelection(),this.selectedHandles.includes(e)?this._removeFromSelection(e,!0):this._addToSelection(e)))}_onGraphicMoveStartCallback(t){const e=t.graphic,{dx:i,dy:s}=t;if(this._resetGraphicStateVars(),this._resetSnappingStateVars(),e===this.graphic)return this.handleGraphics.forEach((t=>t.visible=!1)),this.midpointGraphics.forEach((t=>t.visible=!1)),this._clearSelection(),void this._emitMoveStartEvent(i,s);if(this._isMidpoint(e)){this._clearSelection();const t=this.graphic.clone(),i=this._createHandleFromMidpoint(e);this._emitVertexAddEvent([e],t,i),this._addToSelection(e)}else this.selectedHandles.includes(e)||(this._clearSelection(),this._addToSelection(e));this._setUpGeometryHelper(),this._saveSnappingContextForHandle(e,t),this._onHandleMove(e,i,s,t),this._emitReshapeStartEvent(e)}_onGraphicMoveCallback(t){const{graphic:e,dx:i,dy:s}=t;this._totalDx+=i,this._totalDy+=s,e===this.graphic?(this._syncGraphicsWithGeometry(),this._emitMoveEvent(i,s)):(this._onHandleMove(e,i,s,t),this._emitReshapeEvent(e))}_onGraphicMoveStopCallback(t){const{graphic:e,dx:i,dy:s}=t;if(this._totalDx+=i,this._totalDy+=s,e===this.graphic){this._syncGraphicsWithGeometry();for(const t of[].concat(this.handleGraphics,this.midpointGraphics))t.visible=!0;this._emitMoveStopEvent(),this._resetGraphicStateVars()}else this._onHandleMove(e,i,s,t),this._resetSnappingStateVars(),this._isMidpoint(e)&&this.refresh(),this._emitReshapeStopEvent(e),this._resetGraphicStateVars()}_syncGraphicsWithGeometry(){const t=this.graphic.geometry,e="polyline"===t.type?t.paths:t.rings;this._updateHandleGraphicLocations(e),this._updateMidpointGraphicLocations(e)}_updateHandleGraphicLocations(t){for(const e of this.handleGraphics){const{pathIndex:i,pointIndex:s}=e.attributes,[r,a]=t[i][s];e.set("geometry",new n.Z(r,a,this.view.spatialReference))}}_updateMidpointGraphicLocations(t){for(const e of this.midpointGraphics){const{pathIndex:i,pointIndexStart:s,pointIndexEnd:r}=e.attributes,[a,h]=t[i][s],[o,l]=t[i][r],[p,d]=(0,c.Gi)([a,h],[o,l]);e.geometry=new n.Z({x:p,y:d,spatialReference:this.view.spatialReference})}}_getVertexFromEditGeometry(t){var e;const{pathIndex:i,pointIndex:s}=t.attributes;return null==(e=this._geometryHelper)?void 0:e.editGeometry.components[i].vertices[s]}_onHandleMove(t,e,i,s){(0,r.IM)(this._snappingTask);const a=t.geometry,h="graphic-move-stop"===s.type;if((0,r.pC)(this.snappingManager)&&1===this.selectedHandles.length&&!h){const s=this.snappingManager;this._stagedVertex=s.update(a,this._snappingContext),this._syncGeometryAfterHandleMove(t,new n.Z(this._stagedVertex),e,i,h),this._emitReshapeEvent(t),this._snappingTask=(0,o.vr)((async r=>{const o=await s.snap(a,this._snappingContext,r);o.valid&&(this._stagedVertex=o.apply(),this._syncGeometryAfterHandleMove(t,new n.Z(this._stagedVertex),e,i,h),this._emitReshapeEvent(t))}))}else{const o=(0,r.pC)(this._stagedVertex)?new n.Z(this._stagedVertex):a;this._syncGeometryAfterHandleMove(t,o,e,i,h),"graphic-move"===s.type&&this._emitReshapeEvent(t)}}async _syncGeometryAfterHandleMove(t,e,i,s,r=!1){const{x:a,y:h}=e,o=this._getUpdatedGeometryAfterHandleMove(t,e);let n="polyline"===o.type?o.paths:o.rings;this._isHandle(t)&&(n=this._moveRelatedCoordinates(n,t,a,h),n=this._moveSelectedHandleCoordinates(n,t,i,s,"polygon"===o.type),this._updateMidpointGraphicLocations(n)),this.graphic.geometry=o,this._syncEditGeometryAfterHandleMove(t,a,h),r&&(t.geometry=e)}_getUpdatedGeometryAfterHandleMove(t,e){const{x:i,y:s}=e,a=(0,r.Wg)(this.graphic.geometry).clone(),h="polyline"===a.type?a.paths:a.rings,{pathIndex:o,pointIndex:n}=t.attributes,c=h[o].length-1;return h[o][n]=[i,s],"polygon"===a.type&&(0===n?h[o][c]=[i,s]:n===c&&(h[o][0]=[i,s])),a}_moveRelatedCoordinates(t,e,i,s){const{relatedGraphicIndices:r}=e.attributes;for(const a of r){const r=this.handleGraphics[a],{pathIndex:h,pointIndex:o}=r.attributes;t[h][o]=[i,s],r.geometry=e.geometry}return t}_moveSelectedHandleCoordinates(t,e,i,s,r){for(const a of this.selectedHandles)if(a!==e){const{pathIndex:e,pointIndex:h,relatedGraphicIndices:o}=a.attributes,n=(0,G.e7)(a.geometry,i,s,this.view),c=t[e].length-1;t[e][h]=[n.x,n.y],a.geometry=n,r&&(0===h?t[e][c]=[n.x,n.y]:h===c&&(t[e][0]=[n.x,n.y]));for(const e of o){const i=this.handleGraphics[e],{pathIndex:s,pointIndex:r}=i.attributes;t[s][r]=[n.x,n.y],i.geometry=n}}return t}_syncEditGeometryAfterHandleMove(t,e,i){const s=this._getVertexFromEditGeometry(t),r=e-s.pos[0],a=i-s.pos[1];this._geometryHelper.moveVertices([s],r,a,0)}_onGraphicPointerOverCallback(t){const e=t.graphic;this._isHandle(e)&&!this._isSelected(e)&&(e.symbol=this.symbols.vertices.hover),this._updateHoverCursor(e)}_onGraphicPointerOutCallback(t){const e=t.graphic;this._isHandle(e)&&!this._isSelected(e)&&(e.symbol=this.symbols.vertices.default),this.view.cursor="default"}_createHandleFromMidpoint(t){const{_graphicAttributes:e}=this,i=[],s=(0,r.Wg)(this.graphic.geometry).clone(),{pathIndex:a,pointIndexStart:h,pointIndexEnd:o}=t.attributes,{x:n,y:c}=t.geometry,l=0===o?h+1:o,p="polyline"===s.type?s.paths:s.rings;return p[a].splice(l,0,[n,c]),t.attributes={...e,pathIndex:a,pointIndex:l,relatedGraphicIndices:[]},i.push({coordinates:p[a][l],componentIndex:a,vertexIndex:l}),this.graphic.geometry=s,i}_removeHandles(t){const e=(0,r.Wg)(this.graphic.geometry).clone(),i="polygon"===e.type?e.rings:e.paths,s=[];t instanceof d.Z&&(t=[t]);for(const e of t){const{x:t,y:r}=e.geometry;for(let e=0;e<i.length;e++){const a=i[e];for(let h=0;h<a.length;h++){const[o,n]=a[h];t===o&&r===n&&(s.push({coordinates:i[e][h],componentIndex:e,vertexIndex:h}),i[e].splice(Number(h),1))}}}if("polygon"===e.type)for(const t of i){const[e,s]=t[0],[r,a]=t[t.length-1];(1===t.length||t.length<3&&e===r&&s===a)&&i.splice(i.indexOf(t),1),t.length>2&&(e!==r||s!==a)&&t.push(t[0])}else for(const t of i)1===t.length&&i.splice(i.indexOf(t),1);return this.graphic.geometry=e,s}_addToSelection(t){t instanceof d.Z&&(t=[t]);for(const e of t)e.symbol=this.symbols.vertices.selected;this._set("selectedHandles",this.selectedHandles.concat(t)),this._emitSelectEvent(t)}_removeFromSelection(t,e){const{vertices:i}=this.symbols,s=e?i.hover:i.default;t instanceof d.Z&&(t=[t]);for(const e of t)this.selectedHandles.splice(this.selectedHandles.indexOf(e),1),this._set("selectedHandles",this.selectedHandles),e.set("symbol",s);this._emitDeselectEvent(t)}_clearSelection(){if(this.selectedHandles.length){const t=this.selectedHandles;for(const t of this.selectedHandles)t.set("symbol",this.symbols.vertices.default);this._set("selectedHandles",[]),this._emitDeselectEvent(t)}}_keyDownHandler(t){P.removeVertex.includes(t.key)&&!t.repeat&&this.selectedHandles.length&&this._removeVertex(this.selectedHandles)}_removeVertex(t){if("polygon"===this.graphic.geometry.type&&this.handleGraphics.length<4||this.handleGraphics.length<3)return;const e=this.graphic.clone();t instanceof d.Z&&(t=[t]);const i=this._removeHandles(t);this.refresh(),this._emitVertexRemoveEvent(t,e,i)}_isHandle(t){return this.handleGraphics.includes(t)}_isSelected(t){return this._isHandle(t)&&this.selectedHandles.includes(t)}_isMidpoint(t){return this.midpointGraphics.includes(t)}_updateHoverCursor(t){this.view.cursor=this._isMidpoint(t)?"copy":"move"}_emitMoveStartEvent(t,e){const i=new H(this.graphic,t,e);this.emit("move-start",i),this.callbacks.onMoveStart&&this.callbacks.onMoveStart(i)}_emitMoveEvent(t,e){const i=new M(this.graphic,t,e);this.emit("move",i),this.callbacks.onMove&&this.callbacks.onMove(i)}_emitMoveStopEvent(){const t=new E(this.graphic,this._totalDx,this._totalDy);this.emit("move-stop",t),this.callbacks.onMoveStop&&this.callbacks.onMoveStop(t)}_emitReshapeStartEvent(t){const e=new S(this.graphic,t,this.selectedHandles);this.emit("reshape-start",e),this.callbacks.onReshapeStart&&this.callbacks.onReshapeStart(e)}_emitReshapeEvent(t){const e=new C(this.graphic,t,this.selectedHandles);this.emit("reshape",e),this.callbacks.onReshape&&this.callbacks.onReshape(e)}_emitReshapeStopEvent(t){const e=new k(this.graphic,t,this.selectedHandles);this.emit("reshape-stop",e),this.callbacks.onReshapeStop&&this.callbacks.onReshapeStop(e)}_emitSelectEvent(t){const e=new O(t);this.emit("select",e),this.callbacks.onVertexSelect&&this.callbacks.onVertexSelect(e)}_emitDeselectEvent(t){const e=new D(t);this.emit("deselect",e),this.callbacks.onVertexDeselect&&this.callbacks.onVertexDeselect(e)}_emitVertexAddEvent(t,e,i){const s=new I(t,this.graphic,e,i);this.emit("vertex-add",s),this.callbacks.onVertexAdd&&this.callbacks.onVertexAdd(s)}_emitVertexRemoveEvent(t,e,i){const s=new V(t,this.graphic,e,i);this.emit("vertex-remove",s),this.callbacks.onVertexRemove&&this.callbacks.onVertexRemove(s)}};(0,s._)([(0,a.Cb)()],T.prototype,"callbacks",void 0),(0,s._)([(0,a.Cb)()],T.prototype,"enableMidpoints",void 0),(0,s._)([(0,a.Cb)()],T.prototype,"graphic",void 0),(0,s._)([(0,a.Cb)({readOnly:!0})],T.prototype,"handleGraphics",void 0),(0,s._)([(0,a.Cb)()],T.prototype,"layer",void 0),(0,s._)([(0,a.Cb)({readOnly:!0})],T.prototype,"midpointGraphics",void 0),(0,s._)([(0,a.Cb)()],T.prototype,"midpointSymbol",void 0),(0,s._)([(0,a.Cb)({readOnly:!0})],T.prototype,"selectedHandles",void 0),(0,s._)([(0,a.Cb)()],T.prototype,"snappingManager",void 0),(0,s._)([(0,a.Cb)({readOnly:!0})],T.prototype,"state",null),(0,s._)([(0,a.Cb)({value:A})],T.prototype,"symbols",null),(0,s._)([(0,a.Cb)({readOnly:!0})],T.prototype,"type",void 0),(0,s._)([(0,a.Cb)()],T.prototype,"view",void 0),T=(0,s._)([(0,h.j)("esri.views.draw.support.Reshape")],T);const Z=T},58115:(t,e,i)=>{"use strict";i.d(e,{L:()=>f});var s=i(87397),r=(i(1867),i(18029)),a=i(9783),h=(i(9385),i(82203)),o=i(65482),n=(i(17593),i(15392),i(11786),i(83374)),c=i(78513),l=i(15982),p=i(94528),d=i(61168),v=i(12750),_=i(59609),g=i(33316),y=i(46652),u=i(92382),m=i(63527);const b=a.Z.getLogger("esri.views.interactive.GraphicManipulator");let f=class extends n.Z{constructor(t){super(t),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.events=new c.Z.EventEmitter,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}set graphic(t){"mesh"!==(0,r.U2)(t.geometry,"type")?(this._circleCollisionCache=null,this._originalSymbol=t.symbol,this._set("graphic",t),this.attachSymbolChanged()):b.error("Mesh geometries are not supported")}get elevationInfo(){const t="elevationInfo"in this.graphic.layer&&this.graphic.layer.elevationInfo,e=(0,u.vu)(this.graphic),i=t?t.offset:0;return new _.Z({mode:e,offset:i})}set focusedSymbol(t){t!==this._get("focusedSymbol")&&(this._set("focusedSymbol",t),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(t){t!==this._get("grabbing")&&(this._set("grabbing",t),this._updateGraphicSymbol())}set hovering(t){t!==this._get("hovering")&&(this._set("hovering",t),this._updateGraphicSymbol())}set selected(t){t!==this._get("selected")&&(this._set("selected",t),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:t?"select":"deselect"}))}get _focused(){return this._get("hovering")||this._get("grabbing")}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}intersectionDistance(t){const e=this.graphic;if(!1===e.visible)return null;const i=e.geometry;if((0,r.Wi)(i))return null;const s=this._get("focusedSymbol"),a=(0,r.pC)(s)?s:e.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,t,i,a):this._intersectDistance3D(this.view,t,e)}attach(){this.attachSymbolChanged(),(0,r.pC)(this.layer)&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),(0,r.pC)(this.layer)&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=this.graphic.watch("symbol",(t=>{(0,r.pC)(t)&&t!==this.focusedSymbol&&t!==this._originalSymbol&&(this._originalSymbol=t,this._focused&&(0,r.pC)(this.focusedSymbol)&&(this.graphic.symbol=this.focusedSymbol))}),!0)}detachSymbolChanged(){(0,r.pC)(this._graphicSymbolChangedHandle)&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&(0,r.pC)(this.focusedSymbol)?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(t,e,i,s){if(s=s||(0,g.js)(i),(0,r.Wi)(s))return null;let a=this._circleCollisionCache;if("point"!==i.type||"simple-marker"!==s.type)return(0,m.D)(e,i,t)?1:null;if((0,r.Wi)(a)||!a.originalPoint.equals(i)){const e=i,r=t.spatialReference;if((0,v.Up)(e.spatialReference,r)){const t=(0,v.iV)(e,r);a={originalPoint:e.clone(),mapPoint:t,radiusPx:(0,l.F2)(s.size)},this._circleCollisionCache=a}}if((0,r.pC)(a)){const i=(0,l.md)(e,x),r=t.toScreen(a.mapPoint),h=a.radiusPx,o=r.x+(0,l.F2)(s.xoffset),n=r.y-(0,l.F2)(s.yoffset);return(0,y.j)(i,[o,n])<h*h?1:null}return null}_intersectDistance3D(t,e,i){const s=t.toMap(e,{include:[i]});return s&&(0,v.KC)(s,G,t.renderSpatialReference)?(0,d.k)(G,t.state.camera.eye):null}};(0,s._)([(0,h.Cb)({constructOnly:!0,nonNullable:!0})],f.prototype,"graphic",null),(0,s._)([(0,h.Cb)({readOnly:!0})],f.prototype,"elevationInfo",null),(0,s._)([(0,h.Cb)({constructOnly:!0,nonNullable:!0})],f.prototype,"view",void 0),(0,s._)([(0,h.Cb)({value:null})],f.prototype,"focusedSymbol",null),(0,s._)([(0,h.Cb)({constructOnly:!0})],f.prototype,"layer",void 0),(0,s._)([(0,h.Cb)()],f.prototype,"interactive",void 0),(0,s._)([(0,h.Cb)()],f.prototype,"selectable",void 0),(0,s._)([(0,h.Cb)()],f.prototype,"grabbable",void 0),(0,s._)([(0,h.Cb)({value:!1})],f.prototype,"grabbing",null),(0,s._)([(0,h.Cb)()],f.prototype,"dragging",void 0),(0,s._)([(0,h.Cb)()],f.prototype,"hovering",null),(0,s._)([(0,h.Cb)({value:!1})],f.prototype,"selected",null),(0,s._)([(0,h.Cb)()],f.prototype,"cursor",void 0),f=(0,s._)([(0,o.j)("esri.views.interactive.GraphicManipulator")],f);const G=(0,p.c)(),x=(0,l.s1)()}}]);