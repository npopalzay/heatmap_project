(self.webpackChunkgeog863_final=self.webpackChunkgeog863_final||[]).push([[799],{70799:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>V});var i=a(87397),r=(a(1867),a(9783)),s=(a(9385),a(82203)),n=a(65482),o=(a(17593),a(15392),a(11786),a(14790)),h=a(7422),l=a(2801),p=a(14177),d=a(63527),u=a(90215),c=a(18029),m=a(29107),g=a(43617),y=a(72046),f=a(37813),w=a(22527),v=a(37802);const x=e=>{let t=class extends e{initialize(){this.exportImageParameters=new f.R({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get exportImageVersion(){var e;return null==(e=this.exportImageParameters)||e.commitProperty("version"),this.commitProperty("timeExtent"),(this._get("exportImageVersion")||0)+1}async fetchPopupFeatures(e,t){const{layer:a}=this;if(!e)return Promise.reject(new m.Z("mapimagelayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:a}));const i=this.get("view.scale"),r=[],s=async e=>{const a=0===e.minScale||i<=e.minScale,n=0===e.maxScale||i>=e.maxScale;if(e.visible&&a&&n)if(e.sublayers)e.sublayers.forEach(s);else if(e.popupEnabled){const a=(0,v.V)(e,{...t,defaultPopupTemplateEnabled:!1});(0,c.pC)(a)&&r.unshift({sublayer:e,popupTemplate:a})}},n=a.sublayers.toArray().reverse().map(s);await Promise.all(n);const h=r.map((async({sublayer:a,popupTemplate:i})=>{await a.load().catch((()=>{}));const r=a.createQuery(),s=(0,c.pC)(t)?t.event:null,n=(0,w.k)({renderer:a.renderer,event:s}),o=this.createFetchPopupFeaturesQueryGeometry(e,n);r.geometry=o,r.outFields=await(0,v.e)(a,i);const h=await this._loadArcadeModules(i);return h&&h.arcadeUtils.hasGeometryOperations(i)||(r.maxAllowableOffset=o.width/n),(await a.queryFeatures(r)).features}));return(await(0,o.as)(h)).reduce(((e,t)=>t.value?[...e,...t.value]:e),[]).filter((e=>null!=e))}canResume(){var e;return!(!super.canResume()||null!=(e=this.timeExtent)&&e.isEmpty)}_loadArcadeModules(e){if(e.get("expressionInfos.length"))return(0,g.LC)()}};return(0,i._)([(0,s.Cb)()],t.prototype,"exportImageParameters",void 0),(0,i._)([(0,s.Cb)({readOnly:!0})],t.prototype,"exportImageVersion",null),(0,i._)([(0,s.Cb)()],t.prototype,"layer",void 0),(0,i._)([(0,s.Cb)()],t.prototype,"suspended",void 0),(0,i._)([(0,s.Cb)(y.qG)],t.prototype,"timeExtent",void 0),t=(0,i._)([(0,n.j)("esri.views.layers.MapImageLayerView")],t),t};var b=a(49760),C=a(41730),_=a(97899),I=a(9963),P=a(83003);let T=class extends P.Z{renderChildren(e){if(e.drawPhase!==I.jx.HIGHLIGHT)return;if(this.attributeView.bindTextures(e.context),!this.children.some((e=>e.hasData)))return;super.renderChildren(e);const{painter:t}=e,a=t.effects.highlight;a.bind(e),e.context.setColorMask(!0,!0,!0,!0),e.context.clear(16384),this._renderChildren(e,a.defines.concat(["highlightAll"])),a.draw(e),a.unbind()}};T=(0,i._)([(0,n.j)("esri.views.2d.layers.support.HighlightGraphicContainer")],T);const E=T,F=r.Z.getLogger("esri.views.2d.layers.MapImageLayerView2D");let q=class extends(x((0,l.yc)((0,C.y)(p.Z)))){constructor(){super(...arguments),this._highlightGraphics=new h.ZP}hitTest(){return null}update(e){this.strategy.update(e).catch((e=>{(0,o.D_)(e)||F.error(e)}))}attach(){const{imageMaxWidth:e,imageMaxHeight:t,version:a}=this.layer,i=a>=10.3,r=a>=10;this._bitmapContainer=new b.c,this.container.addChild(this._bitmapContainer);const s=new u.Z({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new E(this.view.featuresTilingScheme)});this.container.addChild(s.container),this.strategy=new _.Z({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:e,imageMaxHeight:t,imageRotationSupported:i,imageNormalizationSupported:r,hidpi:!0}),this.handles.add(this.watch("exportImageVersion",(()=>this.requestUpdate())),"exportImageVersion"),this.requestUpdate()}detach(){this.handles.remove("exportImageVersion"),this.strategy.destroy(),this.container.removeAllChildren(),this._bitmapContainer.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}highlight(e,t){return this._highlightGraphics.add(e),{remove:()=>{this._highlightGraphics.remove(e)}}}createFetchPopupFeaturesQueryGeometry(e,t){return(0,d.K)(e,t,this.view)}async doRefresh(){this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(e,t,a,i){return this.layer.fetchImage(e,t,a,{timeExtent:this.timeExtent,timestamp:this.refreshTimestamp,...i})}};(0,i._)([(0,s.Cb)()],q.prototype,"strategy",void 0),(0,i._)([(0,s.Cb)()],q.prototype,"updating",void 0),q=(0,i._)([(0,n.j)("esri.views.2d.layers.MapImageLayerView2D")],q);const V=q},37802:(e,t,a)=>{"use strict";a.d(t,{V:()=>n,e:()=>s});var i=a(18029),r=a(67638);async function s(e,t=e.popupTemplate){if(!(0,i.pC)(t))return[];const a=await t.getRequiredFields(e.fields),{lastEditInfoEnabled:s}=t,{objectIdField:n,typeIdField:o,globalIdField:h,relationships:l}=e;if(a.includes("*"))return["*"];const p=s?await(0,r.CH)(e):[],d=(0,r.Q0)(e.fields,[...a,...p]);return o&&d.push(o),d&&n&&(0,r.cT)(e.fields,n)&&-1===d.indexOf(n)&&d.push(n),d&&h&&(0,r.cT)(e.fields,h)&&-1===d.indexOf(h)&&d.push(h),l&&l.forEach((t=>{const{keyField:a}=t;d&&a&&(0,r.cT)(e.fields,a)&&-1===d.indexOf(a)&&d.push(a)})),d}function n(e,t){return e.popupTemplate?e.popupTemplate:(0,i.pC)(t)&&t.defaultPopupTemplateEnabled&&(0,i.pC)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}}]);